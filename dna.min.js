//dna.js ~~ v0.1 ~~ dnajs.org/license.html
var dna={util:{value:function(a,b){"string"==typeof b&&(b=b.split("."));return 1==b.length?a[b[0]]:this.value(a[b[0]],b.slice(1))},findAll:function(a,b){return a.find(b).addBack(b)},apply:function(a,b,c){dna.util.findAll(a,b).each(c)}},compile:{regexDnaField:/^(~~|\{\{).*(~~|\}\})$/,regexDnaBasePairs:/~~|\{\{|\}\}/g,isDnaField:function(){var a=$(this)[0].childNodes[0];return a&&a.nodeValue&&a.nodeValue.match(dna.compile.regexDnaField)},fieldElem:function(){$(this).addClass("dna-field").data("dna-field",
$(this).text().replace(dna.compile.regexDnaBasePairs,"")).empty()},attrElem:function(){var a=$(this).data("dna-attr").replace(dna.compile.regexDnaBasePairs,"").split(/[,:]/);$(this).addClass("dna-attr").data("dna-attr",a)},classElem:function(){var a=$(this).data("dna-class").replace(dna.compile.regexDnaBasePairs,"").split(",");$(this).addClass("dna-class").data("dna-class",a)},template:function(a){var b=a.elem.find("*").addBack();b.filter(dna.compile.isDnaField).each(dna.compile.fieldElem);b.filter("[data-dna-attr]").each(dna.compile.attrElem);
b.filter("[data-dna-class]").each(dna.compile.classElem);a.compiled=!0;a.elem.removeClass("dna-template").addClass("dna-clone")}},store:{templates:null,stash:function(){var a=$(this);dna.store.templates||(dna.store.templates={});var b=a.data("dna-name");dna.store.templates[b]={name:b,elem:a,container:a.parent().addClass("dna-contains-"+b),compiled:!1,clones:0};a.detach()},getTemplate:function(a){dna.store.templates||$(".dna-template").each(dna.store.stash);a=dna.store.templates[a];a.compiled||dna.compile.template(a);
return a}},core:{inject:function(a,b){dna.util.apply(a,".dna-field",function(){$(this).html(dna.util.value(b,$(this).data("dna-field")))});var c,e,d;dna.util.apply(a,".dna-attr",function(){c=$(this).data("dna-attr");e=c.length/2;for(d=0;d<e;d+=2)$(this).attr(c[d],dna.util.value(b,c[d+1]))});dna.util.apply(a,".dna-class",function(){c=$(this).data("dna-class");e=c.length;for(d=0;d<e;d++)$(this).addClass(dna.util.value(b,c[d]))})},replicate:function(a,b,c){var e=a.elem.clone(!0,!0);a.clones++;dna.core.inject(e,
b);a=c.holder?dna.util.findAll(c.holder,".dna-contains-"+a.name):a.container;c.top?a.prepend(e):a.append(e);c.fade&&e.hide().fadeIn();return e},unload:function(a,b,c){b.error||dna.api.clone(a,b,c)}},api:{clone:function(a,b,c){var e={fade:!1,top:!1,holder:null};$.extend(e,c);a=dna.store.getTemplate(a);b=b instanceof Array?b:[b];c=$();for(var d=0;d<b.length;d++)c=c.add(dna.core.replicate(a,b[d],e));return c},load:function(a,b,c){$.getJSON(b,function(b){dna.core.unload(a,b,c)})},empty:function(a,b){var c=
{fade:!1};$.extend(c,b);c=c.fade?"normal":0;return dna.store.getTemplate(a).container.find(".dna-clone").fadeOut(c,function(){$(this).remove()})},mutate:function(a,b){dna.core.inject(a,b)},debug:function(){console&&(console.log("~~ dns.js ~~"),console.log("template count: "+Object.keys(dna.store.templates).length),console.log("template names: "+Object.keys(dna.store.templates)),console.log(dna.store.templates))}}};dna.clone=dna.api.clone;dna.load=dna.api.load;dna.empty=dna.api.empty;dna.mutate=dna.api.mutate;
dna.debug=dna.api.debug;
