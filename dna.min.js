// dna.js v1.3.5 ~~ dnajs.org ~~ MIT
var dna={clone:function(e,n,a){var t=$.extend({fade:!1,top:!1,container:null,empty:!1,clones:1,html:!1,transform:null,callback:null},a),d=dna.store.getTemplate(e);d.nested&&!t.container&&dna.core.berserk("Container missing for nested template: "+e),t.empty&&dna.empty(e);for(var o=[];t.clones--;)o=o.concat(n);var i=$();$.each(o,function(e,n){i=i.add(dna.core.replicate(d,n,e,t))}),dna.placeholder.setup();var r=i.first();return r.closest(".dna-menu, .dna-panels").each(dna.panels.refresh),r.parents(".dna-hide").removeClass("dna-hide").addClass("dna-unhide"),i},cloneSub:function(e,n,a,t){var d=dna.compile.subTemplateName(e,n),o=".dna-contains-"+d,i=$.extend({container:e.find(o).addBack(o)},t);dna.clone(d,a,i);var r=dna.getModel(e)[n];return $.each(a instanceof Array?a:[a],function(e,n){r.push(n)}),e},createTemplate:function(e,n,a){return $(n).attr({id:e}).addClass("dna-template").appendTo(a),dna.store.getTemplate(e)},rest:{get:function(e,n,a){return $.getJSON(n,function(n){n.error||dna.clone(e,n,a)})}},getModel:function(e,n){return(e instanceof $?function(e){return dna.getClone(e,n).data("dnaModel")}:function(e){var n=[];return dna.getClones(e).each(function(e,a){n.push(dna.getModel($(a)))}),n})(e)},empty:function(e,n){var a=$.extend({fade:!1},n),t=dna.store.getTemplate(e).container.find(".dna-clone");return a.fade?dna.ui.slideFadeDelete(t):dna.core.remove(t)},refresh:function(e,n){var a=$.extend({html:!1},n),t=dna.getClone(e,n),d=a.data?a.data:dna.getModel(t);return dna.core.inject(t,d,null,a)},refreshAll:function(e){return dna.getClones(e).each(function(e,n){dna.refresh($(n))})},destroy:function(e,n){var a,t=$.extend({fade:!1},n);return(e=dna.getClone(e,n)).hasClass("dna-sub-clone")&&(a=e.data().dnaRules.array,dna.getModel(e.parent())[a].splice(dna.getIndex(e),1)),t.fade?dna.ui.slideFadeDelete(e):dna.core.remove(e)},getClone:function(e,n){var a=$.extend({main:!1},n).main?".dna-clone:not(.dna-sub-clone)":".dna-clone";return e instanceof $?e.closest(a):$()},getClones:function(e){return dna.store.getTemplate(e).container.children().filter(".dna-clone")},getIndex:function(e,n){var a=dna.getClone(e,n);return a.parent().children(".dna-clone").index(a)},up:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!0)},down:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!1)},bye:function(e){return dna.destroy(dna.ui.toElem(e,this),{fade:!0})},registerInitializer:function(e,n){var a=$.extend({onDocumentLoad:!0},n);return a.onDocumentLoad&&dna.util.apply(e,[a.selector?$(a.selector).not(".dna-template "+a.selector).addClass("dna-initialized"):$(window.document)].concat(a.params)),dna.events.initializers.push({func:e,selector:a.selector,params:a.params})},clearInitializers:function(){dna.events.initializers=[]},registerContext:function(e,n){return dna.events.context[e]=n,dna.events.context},info:function(){var e=Object.keys(dna.store.templates);return{version:"1.3.5",templates:e.length,clones:e.reduce(function(e,n){return e+dna.store.templates[n].clones},0),names:e,store:dna.store.templates,initializers:dna.events.initializers}}};dna.array={find:function(e,n,a){a=a||"code";var t=e.filter(function(e){return e[a]===n});return t.length?t[0]:null},fromMap:function(e,n){n=n||"code";var a,t=[];for(var d in e)t[t.push((a=e[d],a instanceof Object?a:{value:a}))-1][n]=dna.util.toKebab(d);return t},last:function(e){return e&&e.length?e[e.length-1]:void 0},toMap:function(e,n){n=n||"code";var a={};return e.forEach(function(e){a[dna.util.toCamel(e[n])]=e}),a}},dna.browser={getUrlParams:function(){var e={};return window.location.search.slice(1).split("&").forEach(function(n){n&&(e[n.split("=")[0]]=n.split("=")[1])}),e},iOS:function(){return/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&/Apple/.test(window.navigator.vendor)}},dna.browser.getParams=dna.browser.getUrlParams,dna.pageToken={put:function(e,n){return window.sessionStorage[e+window.location.pathname]=JSON.stringify(n),n},get:function(e,n){var a=window.sessionStorage[e+window.location.pathname];return void 0===a?n:JSON.parse(a)}},dna.ui={deleteElem:function(e){var n=dna.ui.toElem(e,this);return dna.core.remove(n),n},focus:function(e){return e.focus()},getComponent:function(e){return e.closest("[data-component]")},pulse:function(e,n){var a=$.extend({duration:400,interval:null,out:5e3},n);return e.stop(!0).slideDown().css({opacity:0}).animate({opacity:1},a.duration),a.interval&&e.delay(a.duration+a.interval).animate({opacity:0},a.out),e},slideFade:function(e,n,a){var t={transition:"opacity 0s"};return window.setTimeout(function(){e.css(t)},1e3),a?e.css({opacity:0,transition:"opacity 0s"}).hide().slideDown({complete:n}).css({opacity:1,transition:"opacity 0.4s"}):e.css({opacity:0,transition:"opacity 0.4s"}).slideUp({complete:n}),e},slideFadeIn:function(e,n){return dna.ui.slideFade(e,n,!0)},slideFadeOut:function(e,n){return dna.ui.slideFade(e,n,!1)},slideFadeToggle:function(e,n){return dna.ui.slideFade(e,n,e.is(":hidden"))},slideFadeDelete:function(e){return dna.ui.slideFadeOut(e,dna.ui.deleteElem)},slidingFlasher:function(e){return dna.ui.pulse(e)},smoothHeightSetBaseline:function(e){dna.ui.$container=e=e||$("body");var n=e.outerHeight();return e.css({minHeight:n,maxHeight:n,overflow:"hidden"})},smoothHeightAnimate:function(e,n){return n=n||dna.ui.$container,window.setTimeout(function(){n.css({minHeight:0,maxHeight:"100vh"}),window.setTimeout(function(){n.css({transition:"none",maxHeight:"none"})},1e3)},e||50),window.setTimeout(function(){n.css({transition:"all 1s"})},10),n},smoothMove:function(e,n){var a,t=n?e.prev():e.next();return t.length&&(a=t.clone(),n?e.after(t.hide()).before(a):e.before(t.hide()).after(a),dna.ui.slideFadeIn(t),dna.ui.slideFadeDelete(a)),e},toElem:function(e,n){return e instanceof $?e:$(e?e.target:n)}},dna.util={apply:function(e,n){var a,t,d=void 0===n?[]:[].concat(n),o=d[0];return o instanceof $&&0===o.length?a=o:"function"==typeof e?a=e.apply(o,d):o&&o[e]?a=o[e](d[1],d[2],d[3]):""===e||{number:!0,boolean:!0}[typeof e]?dna.core.berserk("Invalid callback function: "+e):"string"==typeof e&&e.length>0&&(t=e.split("."),o instanceof $&&d.push(dna.ui.getComponent(o)),function n(t,i){!t||1===i.length&&"function"!=typeof t[i[0]]?dna.core.berserk("Callback function not found: "+e):1===i.length?a=t[i[0]].apply(o,d):n(t[i[0]],i.slice(1))}(dna.events.context[t[0]]?dna.events.context:window,t)),a},printf:function(e){return Array.prototype.slice.call(arguments,1).reduce(function(e,n){return e.replace(/%s/,n)},e)},realTruth:function(e){return!!e&&!(e instanceof Array&&0===e.length||/^(f|false|0)$/i.test(e))},toCamel:function(e){return(""+e).replace(/\-(.)/g,function(e,n){return n.toUpperCase()})},toKebab:function(e){return(""+e).replace(/([A-Z]+)/g,function(e){return"-"+e.toLowerCase()}).replace(/\s|^-/g,"")},value:function(e,n){return"string"==typeof n&&(n=n.split(".")),null==e||void 0===n?null:1===n.length?e[n[0]]:this.value(e[n[0]],n.slice(1))}},dna.placeholder={setup:function(){$("option.dna-template").closest("select").addClass("dna-hide"),$("[data-placeholder]").each(function(e,n){var a=$(n).stop(!0);return dna.getClones(a.data().placeholder).length?a.fadeOut():a.fadeIn()})}},dna.panels={display:function(e,n,a){var t,d=e.data().dnaKey,o=e.find(".menu-item");void 0===n&&(n=dna.pageToken.get(d,0)),n=Math.max(0,Math.min(n,o.length-1)),e[0].selectedIndex=n,o.removeClass("selected").addClass("unselected").eq(n).addClass("selected").removeClass("unselected");var i=(t=$(d).children().hide().removeClass("displayed").addClass("hidden").eq(n).fadeIn().addClass("displayed").removeClass("hidden")).data().hash;dna.pageToken.put(d,n),a&&i&&window.history.pushState(null,null,"#"+i),dna.util.apply(e.data().callback,[t,i])},clickRotate:function(e){var n=$(e.target).closest(".menu-item"),a=n.closest(".dna-menu");dna.panels.display(a,a.find(".menu-item").index(n),!0)},selectRotate:function(e){var n=$(e.target);dna.panels.display(n,n.find("option:selected").index(),!0)},reload:function(e){dna.panels.display($("#"+e))},refresh:function(e,n){var a=$(n);a.hasClass("dna-panels")&&(a=$("#"+a.attr("id").replace("-panels","")));var t,d=window.location.hash.slice(1),o=a.data().dnaKey="#"+a.attr("id")+"-panels",i=$(o).children().addClass("panel");function r(e){return e.first().closest(".dna-template").length>0}0===a.find(".menu-item").length&&a.children().addClass("menu-item"),r(i)||r(a.children())||dna.panels.display(a,(t=i,d&&t.first().data().hash?t.filter("[data-hash="+d+"]").index():dna.pageToken.get(o,0)))},setup:function(){$(".dna-menu").each(dna.panels.refresh),$(window.document).on({click:dna.panels.clickRotate},".dna-menu .menu-item"),$(window.document).on({change:dna.panels.selectRotate},".dna-menu")}},dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,setupNucleotide:function(e){return void 0===e.data().dnaRules&&(e.data().dnaRules={}),e.addClass("dna-nucleotide")},isDnaField:function(e,n){var a=n.childNodes[0];return a&&a.nodeValue&&a.nodeValue.match(dna.compile.regexDnaField)},field:function(e,n){return(n=dna.compile.setupNucleotide($(n))).data().dnaRules.text=$.trim(n.text()).replace(dna.compile.regexDnaBasePairs,""),n.empty()},propsAndAttrs:function(e,n){n=$(n);var a=[],t=[],d=[];return $.each(n.get(0).attributes,function(e,o){var i,r,l,s,c;/^data-prop-/.test(o.name)?(s=o.name,c=o.value,d.push(s),s=s.replace(/^data-prop-/,"").toLowerCase(),c=c.replace(dna.compile.regexDnaBasePairs,""),a.push(s,c),"checked"===s&&n.is("input")?n.addClass("dna-update-model").data().dnaField=c:"selected"===s&&n.is("option")&&(n.parent().addClass("dna-update-model").end().data().dnaField=c)):3===o.value.split(dna.compile.regexDnaBasePair).length&&(i=o.name,r=o.value,"[value]"===(l=r.split(dna.compile.regexDnaBasePair))[1]&&(l[1]=!0),t.push(i.replace(/^data-attr-/,""),l),d.push(i),"value"===i&&n.is("input:not(:checkbox, :radio)")&&""===l[0]&&""===l[2]&&(n.addClass("dna-update-model").data().dnaField=l[1]))}),a.length>0&&(dna.compile.setupNucleotide(n).data().dnaRules.props=a),t.length>0&&(dna.compile.setupNucleotide(n).data().dnaRules.attrs=t),n.data().transform&&(dna.compile.setupNucleotide(n).data().dnaRules.transform=n.data().transform),n.data().callback&&(dna.compile.setupNucleotide(n).data().dnaRules.callback=n.data().callback),n.removeAttr(d.join(" "))},getDataField:function(e,n){return $.trim(e.data(n).replace(dna.compile.regexDnaBasePairs,""))},subTemplateName:function(e,n){return(e instanceof $?dna.getClone(e).data().dnaRules.template:e)+"-"+n+"-instance"},rules:function(e,n,a){return e.filter("[data-"+n+"]").each(function(e,t){t=dna.compile.setupNucleotide($(t));var d=dna.compile.getDataField(t,n);t.data().dnaRules[n]=a?d.split(","):d}).removeAttr("data-"+n)},separators:function(e){function n(e,n){return 3===n.nodeType&&!/\S/.test(n.nodeValue)}function a(e,a,t){a&&(e.contents().last().filter(n).remove(),e.append($("<span>").addClass(t).html(a)))}e.find(".dna-template, .dna-sub-clone").addBack().each(function(e,n){var t=$(n);a(t,t.data().separator,"dna-separator"),a(t,t.data().lastSeparator,"dna-last-separator")})},template:function(e){var n=$("#"+e);n.length||dna.core.berserk("Template not found: "+e),n.find(".dna-template").addBack().each(function(e,n){$(n).data().dnaRules={template:$(n).attr("id")}}).removeAttr("id");var a=n.find("*").addBack();return a.filter(dna.compile.isDnaField).each(dna.compile.field),dna.compile.rules(a,"array").addClass("dna-sub-clone"),dna.compile.rules(a,"class",!0),dna.compile.rules(a,"require"),dna.compile.rules(a,"missing"),dna.compile.rules(a,"truthy"),dna.compile.rules(a,"falsey"),dna.compile.rules(a.filter("select"),"option").addClass("dna-update-model"),a.each(dna.compile.propsAndAttrs),dna.compile.separators(n),$("input[data-attr-type]").each(function(e,n){$(n).attr({type:$(n).data().attrType})}),dna.store.stash(n)}},dna.store={templates:{},stash:function(e){var n=e.data().dnaRules.template;function a(e,n){var a=(n=$(n)).data().dnaRules.template,t={name:a,elem:n,container:n.parent().addClass("dna-container").addClass("dna-contains-"+a),nested:0!==n.parent().closest(".dna-clone").length,separators:n.find(".dna-separator, .dna-last-separator").length,index:n.index(),elemsAbove:n.index()>0,elemsBelow:n.nextAll().length>0,clones:0};dna.store.templates[a]=t,n.removeClass("dna-template").addClass("dna-clone").addClass(a).detach()}return e.find(".dna-template").addBack().each(a),e.find(".dna-sub-clone").each(function(e,a){var t=(a=$(a)).data().dnaRules.array,d=dna.compile.subTemplateName(n,t);dna.compile.setupNucleotide(a.parent().addClass("dna-array")).data().dnaRules.loop={name:d,field:t},a.data().dnaRules.template=d}).each(a),dna.store.templates[n]},getTemplate:function(e){return dna.store.templates[e]||dna.compile.template(e)}},dna.events={context:{},initializers:[],elementSetup:function(e,n){var a="[data-on-load]";return(e?e.find(a).addBack(a):$(a)).not(".dna-initialized").each(function(e,a){a=$(a),dna.util.apply(a.data().onLoad,n?[a,n]:a)}).addClass("dna-initialized")},runInitializers:function(e,n){return dna.events.elementSetup(e,n),$.each(dna.events.initializers,function(n,a){var t=a.selector?e.find(a.selector).addBack(a.selector):e;dna.util.apply(a.func,[t.addClass("dna-initialized")].concat(a.params))}),e},setup:function(){function e(e,n,a){var t=(e=e.closest("[data-"+n+"]")).data(n);return"click"===n&&"A"===e.prop("tagName")&&t&&t.match(/^dna[.]/)&&a.preventDefault(),dna.util.apply(t,[e,a])}function n(n){var a,t=$(n.target);function d(e,n){var a;dna.getModel(e)[(a=e.data(),a.dnaRules&&a.dnaRules.option||a.dnaField)]=n(e)}function o(e){return e.val()}function i(e){return e.is(":checked")}function r(e,n){d($(n),i)}return t.hasClass("dna-update-model")&&(0!==(a=dna.getClone(t,{main:!0})).length&&(t.is("input:checkbox")?d(t,i):t.is("input:radio")?$("input:radio[name="+t.attr("name")+"]").each(r):t.is("input")||t.data().dnaRules.option?d(t,o):t.is("select")&&t.find("option").each(r),dna.refresh(a))),e(t,n.type.replace("key","key-"),n)}function a(n){var a=1e3,t=$(n.target),d=t.data();d.smartUpdate&&function(){function o(){d.dnaLastUpdated=Date.now(),d.dnaTimeoutId=void 0,e(t,"smart-update",n)}var i;"keydown"===n.type&&void 0===d.dnaLastValue&&(d.dnaLastValue=t.val()),"keydown"!==n.type&&t.val()!==d.dnaLastValue&&(i=d.smartThrottle?+d.smartThrottle:a,d.dnaLastValue=t.val(),d.dnaTimeoutId||(Date.now()<d.dnaLastUpdated+i?d.dnaTimeoutId=window.setTimeout(o,i):o()))}()}$(window.document).click(n).change(n).keyup(n).keyup(function(n){13===n.which&&e($(n.target),"enter-key",n)}).keydown(n).keypress(n).keydown(a).keyup(a).change(a).on({input:n}).on({click:function(e){var n=$(e.target),a=!dna.browser.iOS()&&n.closest(".external-site").length;window.open(n.closest("[data-href]").data().href,a?"_blank":"_self")}},"[data-href]"),dna.events.elementSetup()}},dna.core={inject:function(e,n,a,t){function d(e,d){var o,i,r,l,s,c,u,p,f,m,h,g,v,y=(d=$(d)).data().dnaRules;y.transform&&dna.util.apply(y.transform,n),y.text&&(o=d,i=y.text,{string:!0,number:!0,boolean:!0}[typeof(r="[count]"===i?a+1:"[value]"===i?n:dna.util.value(n,i))]&&(o=t.html?o.html(r):o.text(r))),y.props&&function(e,a){for(var t=0;t<a.length/2;t++)e.prop(a[2*t],dna.util.realTruth(dna.util.value(n,a[2*t+1])))}(d,y.props),y.attrs&&function(e,a){for(var t=0;t<a.length/2;t++){var d=a[2*t],o=a[2*t+1],i=!0===o[1]?n:dna.util.value(n,o[1]),r=[o[0],i,o[2]].join("");e.attr(d,r),/^data-./.test(d)&&e.data(d.substring(5),r),"value"===d&&r!==e.val()&&e.val(r)}}(d,y.attrs),y.class&&(l=d,s=y.class,c=dna.util.value(n,s[0]),u=dna.util.realTruth(c),1===s.length?l.addClass(c):s.length>1&&(l.toggleClass(s[1],u),s[2]&&l.toggleClass(s[2],!u))),y.require&&d.toggle(void 0!==dna.util.value(n,y.require)),y.missing&&d.toggle(void 0===dna.util.value(n,y.missing)),y.truthy&&d.toggle(dna.util.realTruth(dna.util.value(n,y.truthy))),y.falsey&&d.toggle(!dna.util.realTruth(dna.util.value(n,y.falsey))),y.loop&&(p=d,f=y.loop,m=dna.util.value(n,f.field),h=p.children("."+f.name.replace(/[.]/g,"\\.")),m?m.length===h.length?h.each(function(e,n){dna.core.inject($(n),m[e],e,t)}):(h.remove(),dna.clone(f.name,m,{container:p,html:t.html})):n[f.field]=[]),y.option&&(g=d,null!==(v=dna.util.value(n,y.option))&&g.val(v)),y.callback&&dna.util.apply(y.callback,d)}return t.transform&&t.transform(n),function e(n){n.filter(".dna-nucleotide").each(d),n.length&&e(n.children().not(".dna-sub-clone"))}(e),e.data().dnaModel=n,e},replicate:function(e,n,a,t){var d=e.elem.clone(!0,!0);e.clones++,dna.core.inject(d,n,a,t);var o,i=".dna-contains-"+e.name.replace(/[.]/g,"\\."),r=t.container?t.container.find(i).addBack(i):e.container;return t.top&&!e.elemsAbove?r.prepend(d):t.top||e.elemsBelow?t.top?r.children().eq(e.index-1).after(d):r.children().eq(e.index+r.children().filter(".dna-clone").length).before(d):r.append(d),e.separators&&((o=r.children("."+e.name)).find(".dna-separator").show().end().last().find(".dna-separator").hide(),o.find(".dna-last-separator").hide().end().eq(-2).find(".dna-last-separator").show().closest(".dna-clone").find(".dna-separator").hide()),dna.events.runInitializers(d,n),t.callback&&t.callback(d,n),t.fade&&dna.ui.slideFadeIn(d),d},remove:function(e){return e.remove(),dna.placeholder.setup(),e},berserk:function(e){throw new Error("dna.js -> "+e)},plugin:function(){$.fn.dna=function(e){var n=[arguments[1],arguments[2],arguments[3]],a=dna[dna.util.toCamel(e)];return a||dna.core.berserk("Unknown plugin action: "+e),this.each(function(e,t){a($(t),n[0],n[1],n[2])})}},initModule:function(e,n){return window=e,$=n,window.dna=dna,dna.core.setup(),dna},setup:function(){dna.core.plugin(),$(dna.placeholder.setup),$(dna.panels.setup),$(dna.events.setup)}},"object"==typeof module?module.exports=dna.core.initModule:dna.core.setup();